import heapq
from collections import defaultdict


"""
ç¬¬ä¸€é¢˜ï¼šæœºåœºç™»æœºå£åŠ¨æ€åˆ†é… (é—®é¢˜å»ºæ¨¡ä¸æ¨¡æ‹Ÿ - çº¢ç¯åŒº ğŸš¨)

ä¸»é¢˜: æ¨¡æ‹Ÿä¸€ä¸ªç®€åŒ–çš„æœºåœºç™»æœºå£åˆ†é…ç³»ç»Ÿã€‚

æœºåœºæœ‰ G ä¸ªç™»æœºå£ï¼Œç¼–å· 0 åˆ° G-1ã€‚N æ¶é£æœºæŒ‰é¡ºåºè¯·æ±‚é™è½ï¼Œä¿¡æ¯å­˜å‚¨åœ¨åˆ—è¡¨ flights ä¸­ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ [request_time, required_gate_time]ï¼Œä»£è¡¨é£æœºçš„è¯·æ±‚æ—¶é—´å’Œæ‰€éœ€çš„ç™»æœºå£å ç”¨æ—¶é•¿ã€‚

åˆ†é…è§„åˆ™å¦‚ä¸‹ï¼š

å½“ä¸€æ¶é£æœºåœ¨ request_time è¯·æ±‚æ—¶ï¼Œç³»ç»Ÿä¼šæŸ¥æ‰¾å½“å‰ç©ºé—²çš„ç™»æœºå£ã€‚

å¦‚æœæœ‰å¤šä¸ªç™»æœºå£ç©ºé—²ï¼Œä¼˜å…ˆåˆ†é…ç»™ç¼–å·æœ€å°çš„é‚£ä¸ªã€‚

å¦‚æœæ²¡æœ‰ç™»æœºå£ç©ºé—²ï¼Œé£æœºéœ€è¦æ’é˜Ÿç­‰å¾…ï¼Œç›´åˆ°æœ‰ç™»æœºå£ç©ºé—²ä¸ºæ­¢ã€‚ç­‰å¾…çš„é£æœºä¸­ï¼Œè¯·æ±‚æ—¶é—´æœ€æ—©çš„ä¼˜å…ˆè·å¾—ä¸‹ä¸€ä¸ªç©ºé—²çš„ç™»æœºå£ã€‚

ç™»æœºå£ä¸€æ—¦è¢«åˆ†é…ï¼Œä¼šä¸€ç›´è¢«å ç”¨ required_gate_time è¿™ä¹ˆé•¿çš„æ—¶é—´ã€‚

ä»»åŠ¡è¦æ±‚ï¼š ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ¨¡æ‹Ÿè¿™ä¸ªåˆ†é…è¿‡ç¨‹ï¼Œå¹¶è®¡ç®—å‡ºæ‰€æœ‰é£æœºå®Œæˆç™»æœºå£å ç”¨ï¼ˆå³ç¦»å¼€ç™»æœºå£ï¼‰çš„æœ€æ™šæ—¶é—´ç‚¹ã€‚

ç¤ºä¾‹:

G = 1 (1ä¸ªç™»æœºå£)

flights = [[0, 5], [1, 3], [3, 4]] (é£æœº0åœ¨t=0è¯·æ±‚ç”¨5å•ä½æ—¶é—´, é£æœº1åœ¨t=1è¯·æ±‚ç”¨3, é£æœº2åœ¨t=3è¯·æ±‚ç”¨4)

è¾“å‡º: 12

è¿‡ç¨‹è§£é‡Š:

t=0: é£æœº0è¯·æ±‚ï¼Œç™»æœºå£0ç©ºé—²ã€‚åˆ†é…ç»™é£æœº0ã€‚ç™»æœºå£0å°†åœ¨ 0 + 5 = 5 æ—¶åˆ»ç©ºé—²ã€‚

t=1: é£æœº1è¯·æ±‚ï¼Œç™»æœºå£0è¢«å ç”¨ã€‚é£æœº1è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚

t=3: é£æœº2è¯·æ±‚ï¼Œç™»æœºå£0ä»è¢«å ç”¨ã€‚é£æœº2è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚

t=5: ç™»æœºå£0ç©ºé—²ã€‚ç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰é£æœº1(t=1è¯·æ±‚)å’Œé£æœº2(t=3è¯·æ±‚)ã€‚ä¼˜å…ˆåˆ†é…ç»™è¯·æ±‚æ›´æ—©çš„é£æœº1ã€‚é£æœº1å¼€å§‹ä½¿ç”¨ç™»æœºå£ã€‚ç™»æœºå£0å°†åœ¨ 5 + 3 = 8 æ—¶åˆ»ç©ºé—²ã€‚

t=8: ç™»æœºå£0ç©ºé—²ã€‚ç­‰å¾…é˜Ÿåˆ—ä¸­åªæœ‰é£æœº2ã€‚åˆ†é…ç»™é£æœº2ã€‚é£æœº2å¼€å§‹ä½¿ç”¨ç™»æœºå£ã€‚ç™»æœºå£0å°†åœ¨ 8 + 4 = 12 æ—¶åˆ»ç©ºé—²ã€‚

t=12: æ‰€æœ‰é£æœºéƒ½å·²å®Œæˆã€‚æœ€æ™šå®Œæˆæ—¶é—´æ˜¯12ã€‚
"""


def gate_assign(G: int, flights: list[list[int]]) -> int:

    if not flights:
        return 0

    flights.sort(key=lambda x: x[0])

    # ä½¿ç”¨æœ€å°å †ç»´æŠ¤ (gate_finish_time, gate_id)
    gate_heap = [(0, i) for i in range(G)]
    heapq.heapify(gate_heap)

    max_finish_time = 0

    for req_time, duration in flights:
        gate_finish_time, gate_id = heapq.heappop(gate_heap)
        start_time = max(req_time, gate_finish_time)
        finish_time = start_time + duration

        max_finish_time = max(max_finish_time, finish_time)
        heapq.heappush(gate_heap, (finish_time, gate_id))

    return max_finish_time


gate_assign(1, [[0, 5], [1, 3], [3, 4]])
